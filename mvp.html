<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Self Protect Community - Prototype</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Red Alert -->
    <!-- Application Structure Plan: The prototype is structured as a single-page application simulating a logged-in user experience, focusing on the MVP features. The core structure is a main content area with a fixed bottom navigation bar for easy switching between the 'Feed', 'Report', 'Diary', and 'Profile' sections. This mobile-first design prioritizes quick access to key functions. Modals are used for critical actions like SOS confirmation and report submission to keep the user within the main application context, enhancing usability for a safety-oriented app. -->
    <!-- Visualization & Content Choices: 1. ATL Score: Presented as a prominent progress bar on the Profile page for clear, at-a-glance understanding of user reputation. 2. Hyper-Local Feed: A dynamic list of cards built with HTML/CSS, populated by JavaScript to simulate real-time updates. 3. SOS Function: A large, floating action button for immediate access, triggering an interactive modal with a countdown to prevent accidental alerts. 4. Report & Diary: Implemented as clean, simple forms within modals to focus the user on the task of data entry. All choices are made to create a functional and intuitive MVP prototype. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
        }
        main {
            flex: 1;
            position: relative;
        }
        .view {
            display: none;
            position: absolute;
            inset: 0;
            overflow-y: auto;
            padding-bottom: 6rem; /* 96px */
        }
        .view.active {
            display: block;
        }
        #view-videos {
            padding-bottom: 0;
            overflow: hidden;
        }
        #view-videos.active {
            display: flex;
            flex-direction: column;
        }
        .nav-item.active svg,
        .nav-item.active span {
            color: #dc2626; /* red-600 */
        }
        .modal {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
        .interaction-btn.active {
            color: #dc2626; /* red-600 */
            font-weight: 700;
        }
        .notification-bar {
            transition: transform 0.5s ease-in-out;
        }
        input[type="radio"]:checked + label {
            border-color: #dc2626;
            background-color: #fee2e2;
            color: #991b1b;
        }
        .profile-link {
            cursor: pointer;
        }
        #reels-container {
            height: 100%;
            width: 100%;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
        }
        .reel-item {
            height: 100%;
            width: 100%;
            scroll-snap-align: start;
            position: relative;
            background-size: cover;
            background-position: center;
        }
        .video-tab-btn {
            flex: 1;
            padding: 0.75rem;
            font-weight: 600;
            color: #475569;
            border-bottom: 2px solid transparent;
        }
        .video-tab-btn.active {
            color: #dc2626;
            border-bottom-color: #dc2626;
        }
    </style>
</head>
<body class="h-screen flex flex-col">

    <!-- Main Content Area -->
    <main>
        <!-- Home / Feed View -->
        <div id="view-feed" class="view active">
            <header class="bg-white shadow-sm p-4 sticky top-0 z-10">
                <h1 class="text-xl font-bold text-slate-800">Community Feed</h1>
                <p class="text-sm text-slate-500">Hyper-local updates for your area</p>
            </header>
            
            <div id="notification-bar" class="notification-bar hidden bg-red-100 border-b-2 border-red-500 p-3 transform -translate-y-full">
                <div class="container mx-auto flex justify-between items-center">
                    <p class="text-sm font-semibold text-red-700">
                        <span class="font-bold">URGENT:</span> A member near you needs help.
                    </p>
                    <button id="view-sos-btn" class="text-sm font-bold text-red-700 bg-red-200 px-3 py-1 rounded-full">View</button>
                </div>
            </div>

            <div id="feed-container" class="p-2 md:p-4 space-y-3">
                <!-- Feed items will be injected here by JS -->
            </div>
        </div>
        
        <!-- Videos View -->
        <div id="view-videos" class="view">
            <header class="bg-white shadow-sm sticky top-0 z-10 flex-shrink-0">
                <div class="flex justify-around">
                    <button class="video-tab-btn active" data-tab="reels">Reels</button>
                    <button class="video-tab-btn" data-tab="training">Training</button>
                </div>
            </header>
            <div class="flex-grow relative">
                <div id="reels-container" class="video-tab-content absolute inset-0">
                    <!-- Video reel items will be injected here by JS -->
                </div>
                <div id="training-container" class="video-tab-content hidden absolute inset-0 p-4 grid grid-cols-1 md:grid-cols-2 gap-4 overflow-y-auto">
                    <!-- Training video cards will be injected here by JS -->
                </div>
            </div>
        </div>

        <!-- SafeCircle View -->
        <div id="view-safecircle" class="view">
            <header class="bg-white shadow-sm p-4 sticky top-0 z-10 flex justify-between items-center">
                <div>
                    <h1 class="text-xl font-bold text-slate-800">SafeCircle</h1>
                    <p class="text-sm text-slate-500">Your trusted network</p>
                </div>
                <button id="create-safecircle-btn" class="bg-red-600 text-white font-bold py-2 px-4 rounded-lg text-sm">Create Circle</button>
            </header>
            <div class="p-4 space-y-6">
                <!-- Safe Map Section -->
                <div id="safe-map-card" class="bg-white p-4 rounded-lg shadow cursor-pointer">
                    <h2 class="font-bold text-lg text-slate-800 mb-2">Safe Map</h2>
                    <div class="h-32 bg-slate-200 rounded-lg flex items-center justify-center">
                        <p class="text-slate-500 font-semibold">Tap to view your safety dashboard</p>
                    </div>
                </div>

                <div>
                    <h2 class="font-bold text-slate-700 mb-3">My SafeCircles</h2>
                    <div id="my-safecircle-container" class="space-y-3">
                        <!-- User's SafeCircles will be injected here -->
                    </div>
                </div>
                 <div>
                    <h2 class="font-bold text-slate-700 mb-3">Suggested Circles</h2>
                    <div id="suggested-safecircle-container" class="space-y-3">
                        <!-- Suggested SafeCircles will be injected here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile View -->
        <div id="view-profile" class="view">
             <header class="bg-white shadow-sm p-4 sticky top-0 z-10">
                <h1 class="text-xl font-bold text-slate-800">My Profile</h1>
            </header>
            <div class="p-4 space-y-6">
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-slate-200 rounded-full flex items-center justify-center text-slate-500 text-2xl font-bold">
                            MN
                        </div>
                        <div>
                            <h2 class="text-lg font-bold text-slate-800">Md Imtiaz Ahmed Nahid</h2>
                            <p id="main-profile-label" class="text-sm font-bold"></p>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-bold text-slate-800 mb-3">Algorithmic Trust Ledger (ATL) Score</h3>
                    <p class="text-sm text-slate-500 mb-4">Your score is based on your positive contributions to the community. It increases as you verify reports and receive thanks.</p>
                    <div class="w-full bg-slate-200 rounded-full h-4">
                        <div id="atl-score-bar" class="bg-red-500 h-4 rounded-full" style="width: 65%;"></div>
                    </div>
                    <p id="atl-score-text" class="text-right font-bold text-red-600 mt-2">65 / 100</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Floating SOS Button -->
    <button id="sos-button" class="fixed bottom-20 right-5 bg-red-600 text-white rounded-full w-16 h-16 flex items-center justify-center shadow-xl z-30 animate-pulse">
        <span class="font-bold text-xl">SOS</span>
    </button>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white shadow-t border-t border-slate-200 flex justify-around p-2 z-20">
        <button class="nav-item active flex flex-col items-center text-slate-500 w-1/5" data-view="feed">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
            <span class="text-xs font-medium">Feed</span>
        </button>
        <button class="nav-item flex flex-col items-center text-slate-500 w-1/5" data-view="videos">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            <span class="text-xs font-medium">Videos</span>
        </button>
        <button id="nav-report-btn" class="nav-item flex flex-col items-center text-slate-500 w-1/5" data-view="report">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
            <span class="text-xs font-medium">Report</span>
        </button>
        <button class="nav-item flex flex-col items-center text-slate-500 w-1/5" data-view="safecircle">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
            <span class="text-xs font-medium">SafeCircle</span>
        </button>
        <button class="nav-item flex flex-col items-center text-slate-500 w-1/5" data-view="profile">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
            <span class="text-xs font-medium">Profile</span>
        </button>
    </nav>

    <!-- Modals -->
    <div id="modal-container" class="fixed inset-0 z-40 pointer-events-none">
        <!-- SOS Modal -->
        <div id="sos-modal" class="modal hidden opacity-0 fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4">
            <div class="modal-content bg-white rounded-lg shadow-2xl p-6 w-full max-w-sm text-center transform scale-95">
                <h2 class="text-2xl font-bold text-red-600">SOS ALERT</h2>
                <p class="text-slate-600 my-4">An alert will be sent to your emergency contacts and local SafeCircle members. Are you sure?</p>
                <div id="sos-countdown" class="text-6xl font-bold text-red-600 my-6">5</div>
                <div id="sos-location" class="text-sm text-slate-500 font-mono h-4"></div>
                <button id="cancel-sos-btn" class="w-full bg-slate-200 text-slate-800 font-bold py-3 px-4 rounded-lg mt-4">Cancel</button>
            </div>
        </div>

        <!-- Report Modal -->
        <div id="report-modal" class="modal hidden opacity-0 fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4">
            <div class="modal-content bg-white rounded-lg shadow-xl p-6 w-full max-w-md transform scale-95">
                <h2 class="text-xl font-bold text-slate-800 mb-4">Report or Log</h2>
                <form id="report-form">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-slate-700 mb-2">What would you like to do?</label>
                        <div class="space-y-2">
                            <div>
                                <input type="radio" name="report_type" id="report_type_general" value="general" class="sr-only" checked>
                                <label for="report_type_general" class="w-full text-left block p-3 border-2 border-slate-200 rounded-lg cursor-pointer">Report a General Issue</label>
                            </div>
                            <div>
                                <input type="radio" name="report_type" id="report_type_user" value="user" class="sr-only">
                                <label for="report_type_user" class="w-full text-left block p-3 border-2 border-slate-200 rounded-lg cursor-pointer">Report a User</label>
                            </div>
                            <div>
                                <input type="radio" name="report_type" id="report_type_diary" value="diary" class="sr-only">
                                <label for="report_type_diary" class="w-full text-left block p-3 border-2 border-slate-200 rounded-lg cursor-pointer">Log an Incident in Diary</label>
                            </div>
                        </div>
                    </div>
                    
                    <div id="form-general-issue">
                        <div class="mb-4">
                            <label for="report-title" class="block text-sm font-medium text-slate-700">Title</label>
                            <input type="text" id="report-title" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500" placeholder="e.g., Broken Streetlight">
                        </div>
                        <div class="mb-4">
                            <div class="flex justify-between items-center mb-1">
                                <label for="report-location" class="block text-sm font-medium text-slate-700">Location</label>
                                <button type="button" id="get-location-btn" class="text-xs font-semibold text-red-600 hover:text-red-800">Use Current Location</button>
                            </div>
                            <input type="text" id="report-location" class="block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500" placeholder="e.g., Road 5, Dhanmondi">
                        </div>
                    </div>

                    <div id="form-user-report" class="hidden">
                        <div class="mb-4">
                            <label for="report-user-name" class="block text-sm font-medium text-slate-700">Username to Report</label>
                            <input type="text" id="report-user-name" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500" placeholder="e.g., user123">
                        </div>
                    </div>
                    
                    <div id="form-diary-log" class="hidden">
                        <p class="text-sm text-slate-500 mb-2">This will be saved privately to your encrypted diary.</p>
                    </div>

                    <div class="mb-6">
                        <label for="report-description" class="block text-sm font-medium text-slate-700">Description / Details</label>
                        <textarea id="report-description" rows="4" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500" placeholder="Provide more details..." required></textarea>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancel-report-btn" class="bg-slate-200 text-slate-800 font-bold py-2 px-4 rounded-lg">Cancel</button>
                        <button type="submit" class="bg-red-600 text-white font-bold py-2 px-4 rounded-lg">Submit</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Create SafeCircle Modal -->
        <div id="create-safecircle-modal" class="modal hidden opacity-0 fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4">
            <div class="modal-content bg-white rounded-lg shadow-xl p-6 w-full max-w-md transform scale-95">
                <h2 class="text-xl font-bold text-slate-800 mb-4">Create a New SafeCircle</h2>
                <form id="create-safecircle-form">
                    <div class="mb-4">
                        <label for="safecircle-name" class="block text-sm font-medium text-slate-700">Circle Name</label>
                        <input type="text" id="safecircle-name" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500" placeholder="e.g., Family, Neighborhood Friends" required>
                    </div>
                    <div class="mb-6">
                        <label for="safecircle-members" class="block text-sm font-medium text-slate-700">Invite Members (Usernames)</label>
                        <input type="text" id="safecircle-members" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500" placeholder="e.g., user123, another_user">
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancel-create-safecircle-btn" class="bg-slate-200 text-slate-800 font-bold py-2 px-4 rounded-lg">Cancel</button>
                        <button type="submit" class="bg-red-600 text-white font-bold py-2 px-4 rounded-lg">Create Circle</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- View Profile Modal -->
        <div id="view-profile-modal" class="modal hidden opacity-0 fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4">
            <div class="modal-content bg-white rounded-lg shadow-xl p-6 w-full max-w-sm transform scale-95">
                 <div class="flex items-center space-x-4">
                    <div id="view-profile-initials" class="w-16 h-16 bg-slate-200 rounded-full flex items-center justify-center text-slate-500 text-2xl font-bold"></div>
                    <div>
                        <h2 id="view-profile-name" class="text-lg font-bold text-slate-800"></h2>
                        <p id="view-profile-label" class="text-sm font-bold"></p>
                    </div>
                </div>
                <div class="mt-6">
                     <h3 class="font-bold text-slate-800 mb-2">Contribution Points</h3>
                     <p id="view-profile-points" class="text-3xl font-bold text-red-600"></p>
                </div>
                <button id="close-profile-modal-btn" class="mt-6 w-full bg-slate-200 text-slate-800 font-bold py-2 px-4 rounded-lg">Close</button>
            </div>
        </div>

        <!-- Safe Map Modal -->
        <div id="safe-map-modal" class="modal hidden opacity-0 fixed inset-0 bg-black bg-opacity-80 flex flex-col p-4">
            <div class="modal-content bg-slate-800 rounded-lg shadow-2xl w-full max-w-3xl mx-auto flex-1 flex flex-col transform scale-95">
                <header class="p-4 flex justify-between items-center border-b border-slate-700 flex-shrink-0">
                    <h2 class="text-xl font-bold text-white">Safe Map</h2>
                    <button id="close-safe-map-btn" class="text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </header>
                <div class="flex-grow p-4 overflow-y-auto space-y-4">
                    <div class="bg-slate-700 p-4 rounded-lg">
                        <h3 class="font-bold text-white mb-2">Nearest Thana</h3>
                        <p class="text-slate-300">Gazipur Sadar Police Station</p>
                    </div>
                    <div class="bg-slate-700 p-4 rounded-lg">
                        <h3 class="font-bold text-white mb-2">Nearby Neighbors</h3>
                        <p class="text-slate-300">A. Khan, S. Rahman, R. Begum</p>
                    </div>
                    <div class="bg-slate-700 p-4 rounded-lg">
                        <h3 class="font-bold text-white mb-2">Relatives Near Me</h3>
                        <p class="text-slate-300">F. Ahmed, R. Begum</p>
                    </div>
                    <div class="bg-slate-700 p-4 rounded-lg">
                        <h3 class="font-bold text-white mb-2">BloodLink</h3>
                        <div class="flex space-x-4 mt-2">
                            <button class="flex-1 bg-red-600 text-white font-bold py-2 px-4 rounded-lg">Request Blood</button>
                            <button class="flex-1 bg-emerald-600 text-white font-bold py-2 px-4 rounded-lg">Find Donors</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const views = document.querySelectorAll('.view');
            const navItems = document.querySelectorAll('.nav-item');
            const modalContainer = document.getElementById('modal-container');

            // --- Mock Data ---
            let users = {
                'S. Rahman': { initials: 'SR', joined: 'July 2025', atlScore: 85, contributionPoints: 3400 },
                'F. Ahmed': { initials: 'FA', joined: 'June 2025', atlScore: 60, contributionPoints: 950 },
                'A. Khan': { initials: 'AK', joined: 'May 2025', atlScore: 40, contributionPoints: 1250 },
                'R. Begum': { initials: 'RB', joined: 'August 2025', atlScore: 78, contributionPoints: 2800 },
                'Safety Influencer': { initials: 'SI', joined: 'January 2025', atlScore: 95, contributionPoints: 15000 },
                'Community Org': { initials: 'CO', joined: 'January 2025', atlScore: 100, contributionPoints: 0 },
                'user123': { initials: 'U', joined: 'September 2025', atlScore: 15, contributionPoints: 150 }
            };

            let feedData = [
                { id: 7, type: 'case', reporter: 'S. Rahman', reportedUser: 'user123', reason: 'Spreading misinformation and creating panic in the community feed regarding recent events.', status: 'Under Review', time: '5m ago' },
                { id: 5, type: 'sos', title: 'URGENT ASSISTANCE NEEDED', description: 'User has triggered an SOS alert. They may be in distress. SafeCircle members have been notified.', location: 'Near Gazipur Station', user: 'F. Ahmed', time: '10m ago', reactions: { thanks: 1, disputed: 0, helpful: 2 } },
                { id: 1, type: 'gr', title: 'Suspicious Activity Near Park', description: 'A group has been loitering near the children\'s play area after 10 PM for the last three nights. It feels unsafe.', location: 'Gulshan 2', user: 'A. Khan', time: '25m ago', reactions: { thanks: 8, disputed: 6, helpful: 3 } },
                { id: 6, type: 'gr', title: 'Street Racing on Main Road', description: 'Motorbikes are racing late at night on the main road, creating a lot of noise and a dangerous situation for pedestrians. This is a recurring issue.', location: 'Uttara Sector 10', user: 'R. Begum', time: '45m ago', reactions: { thanks: 25, disputed: 2, helpful: 15 }, image: 'https://placehold.co/600x300/e2e8f0/475569?text=Street+View' },
                { id: 2, type: 'tip', title: 'Tip: Check Locks Before Leaving', description: 'A simple reminder to double-check your doors and windows before you leave home can prevent opportunistic theft. Stay safe!', user: 'Safety Influencer', time: '2h ago', reactions: { thanks: 52, disputed: 1, helpful: 80 } },
                { id: 3, type: 'gr', title: 'Broken Streetlight', description: 'The main streetlight on the corner of Road 5 and 7 has been out for over a week, making the entire intersection very dark and dangerous at night.', location: 'Road 5, Dhanmondi', user: 'S. Rahman', time: '4h ago', reactions: { thanks: 3, disputed: 0, helpful: 1 } },
                { id: 4, type: 'info', title: 'Community Meeting: Neighborhood Watch', description: 'There will be a community meeting this Sunday at the community center to discuss forming an official neighborhood watch program. All residents are encouraged to attend.', location: 'Banani Community Center', user: 'Community Org', time: 'This Sunday at 5 PM', status: 'Fact-Checked', reactions: { thanks: 18, disputed: 0, helpful: 25 } }
            ];
            
            const reelsData = [
                { id: 1, user: 'Safety Influencer', title: 'First Aid Basics', description: 'How to handle common injuries.', thumbnail: 'https://placehold.co/1080/1920/ef4444/ffffff?text=First+Aid', reactions: { helpful: 1200, flag: 5, thanks: 450 } },
                { id: 2, user: 'Community Org', title: 'Online Scam Awareness', description: 'Protect yourself from common online scams.', thumbnail: 'https://placehold.co/1080/1920/f97316/ffffff?text=Cybersecurity', reactions: { helpful: 2500, flag: 12, thanks: 1120 } },
                { id: 3, user: 'Safety Influencer', title: 'Home Fire Safety', description: 'A checklist for a fire-safe home.', thumbnail: 'https://placehold.co/1080/1920/f59e0b/ffffff?text=Fire+Safety', reactions: { helpful: 980, flag: 2, thanks: 300 } },
                { id: 4, user: 'A. Khan', title: 'Situational Awareness', description: 'How to be more aware of your surroundings.', thumbnail: 'https://placehold.co/1080/1920/84cc16/ffffff?text=Self-Defense', reactions: { helpful: 3100, flag: 25, thanks: 1500 } }
            ];

            const trainingData = [
                { id: 1, title: 'Fire Safety 101', category: 'Emergency Prep', thumbnail: 'https://placehold.co/600x400/ef4444/ffffff?text=Fire+Safety' },
                { id: 2, title: 'Personal Safety for Commuters', category: 'Self-Defense', thumbnail: 'https://placehold.co/600x400/f97316/ffffff?text=Personal+Safety' },
                { id: 3, title: 'Basic First Aid: CPR', category: 'First Aid', thumbnail: 'https://placehold.co/600x400/22c55e/ffffff?text=First+Aid' },
                { id: 4, title: 'Digital Security Basics', category: 'Cybersecurity', thumbnail: 'https://placehold.co/600x400/3b82f6/ffffff?text=Digital+Safety' }
            ];

            let diaryEntries = [];
            
            let mySafeCircles = [
                { id: 1, name: 'Family', members: ['F. Ahmed', 'R. Begum'] },
                { id: 2, name: 'Dhanmondi Neighbors', members: ['S. Rahman', 'A. Khan'] }
            ];

            const suggestedSafeCircles = [
                { id: 3, name: 'Gazipur Block A Watch', members: ['user123', 'F. Ahmed'], mutual: 1 },
                { id: 4, name: 'Evening Walkers Club', members: ['S. Rahman', 'R. Begum'], mutual: 2 }
            ];

            // --- View Navigation ---
            function switchView(viewId) {
                views.forEach(view => view.classList.remove('active'));
                document.getElementById(`view-${viewId}`).classList.add('active');
                navItems.forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.view === viewId) item.classList.add('active');
                });
            }

            navItems.forEach(item => {
                if (item.dataset.view !== 'report') {
                    item.addEventListener('click', () => switchView(item.dataset.view));
                }
            });

            // --- Modal Handling ---
            function openModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modalContainer.classList.remove('pointer-events-none');
                    modal.classList.remove('hidden');
                    setTimeout(() => {
                        modal.classList.remove('opacity-0');
                        modal.querySelector('.modal-content').classList.remove('scale-95');
                    }, 10);
                }
            }

            function closeModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.add('opacity-0');
                    modal.querySelector('.modal-content').classList.add('scale-95');
                    setTimeout(() => {
                        modal.classList.add('hidden');
                        modalContainer.classList.add('pointer-events-none');
                    }, 300);
                }
            }
            
            // --- User Label Logic ---
            function getLabelForScore(score) {
                if (score >= 75) return { text: 'Trusted Contributor', color: 'emerald' };
                if (score >= 50) return { text: 'Community Member', color: 'blue' };
                if (score >= 25) return { text: 'New Member', color: 'amber' };
                return { text: 'Under Review', color: 'slate' };
            }

            function renderMainProfile() {
                const mainUser = users['Md Imtiaz Ahmed Nahid'] || { atlScore: 65 };
                const labelInfo = getLabelForScore(mainUser.atlScore);
                const labelEl = document.getElementById('main-profile-label');
                labelEl.textContent = labelInfo.text;
                labelEl.className = `text-sm font-bold text-${labelInfo.color}-600`;
            }

            // --- Status Calculation ---
            function getStatus(item) {
                if (item.status === 'Fact-Checked') {
                    return { text: 'Fact-Checked', color: 'blue' };
                }
                if (item.type === 'case' || item.type === 'sos' || !item.reactions) {
                    return null;
                }
                const { thanks, disputed, helpful } = item.reactions;
                const totalReactions = thanks + disputed + helpful;

                if (totalReactions < 5) {
                    return { text: 'Not Validated', color: 'amber' };
                }

                const disputedRatio = disputed / totalReactions;

                if (disputedRatio >= 0.4) {
                    return { text: 'Disputed', color: 'red' };
                } else {
                    return { text: 'Community Validated', color: 'emerald' };
                }
            }

            // --- Feed Rendering ---
            function renderFeed() {
                const feedContainer = document.getElementById('feed-container');
                feedContainer.innerHTML = '';
                feedData.forEach(item => {
                    const card = document.createElement('div');
                    card.className = `bg-white rounded-lg shadow-md ${item.type === 'sos' ? 'border-2 border-red-500' : ''}`;
                    card.id = `post-${item.id}`;
                    
                    if (item.type === 'case') {
                        card.innerHTML = `
                            <div class="p-4">
                                <div class="flex items-center mb-3">
                                    <div class="w-10 h-10 bg-slate-700 text-white rounded-full flex items-center justify-center font-bold text-sm">CASE</div>
                                    <div class="ml-3">
                                        <p class="font-bold text-slate-800">Case File Opened</p>
                                        <p class="text-xs text-slate-500">${item.time}</p>
                                    </div>
                                </div>
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-200">
                                    <p class="text-sm text-slate-600"><span class="font-semibold">Reporter:</span> <span class="profile-link text-red-600 font-medium" data-username="${item.reporter}">${item.reporter}</span></p>
                                    <p class="text-sm text-slate-600"><span class="font-semibold">Reported User:</span> <span class="profile-link text-red-600 font-medium" data-username="${item.reportedUser}">${item.reportedUser}</span></p>
                                    <p class="text-sm text-slate-600 mt-2"><span class="font-semibold">Reason:</span> ${item.reason}</p>
                                </div>
                                <div class="mt-3 text-center">
                                    <span class="text-xs font-bold text-amber-600 bg-amber-100 px-3 py-1 rounded-full">${item.status}</span>
                                </div>
                            </div>
                        `;
                    } else {
                        const imageHTML = item.image ? `<img src="${item.image}" alt="User uploaded image for ${item.title}" class="mt-3 rounded-lg w-full object-cover">` : '';
                        const status = getStatus(item);
                        const statusHTML = status ? `<span class="text-xs font-bold text-${status.color}-600 bg-${status.color}-100 px-2 py-1 rounded-full">${status.text}</span>` : '';

                        card.innerHTML = `
                            <div class="p-4">
                                <div class="flex items-center mb-3">
                                    <div class="profile-link w-10 h-10 ${item.type === 'sos' ? 'bg-red-200' : 'bg-slate-200'} rounded-full flex items-center justify-center font-bold ${item.type === 'sos' ? 'text-red-600' : 'text-slate-500'} text-sm" data-username="${item.user}">
                                        ${item.type === 'sos' ? 'SOS' : users[item.user].initials}
                                    </div>
                                    <div class="ml-3 flex-1">
                                        <p class="profile-link font-bold text-slate-800" data-username="${item.user}">${item.user}</p>
                                        <p class="text-xs text-slate-500">${item.time} &middot; ${item.location}</p>
                                    </div>
                                    ${statusHTML}
                                </div>
                                <div class="mb-4">
                                    <p class="font-semibold text-slate-800">${item.title}</p>
                                    <p class="text-slate-600 text-sm">${item.description}</p>
                                    ${imageHTML}
                                </div>
                            </div>
                            <div class="flex justify-around py-2 border-t border-slate-100">
                                <button class="interaction-btn flex-1 flex items-center justify-center space-x-2 text-slate-600 hover:bg-slate-100 rounded-md py-2" data-action="helpful" data-id="${item.id}">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" /></svg>
                                    <span class="text-sm font-medium">${item.reactions.helpful} Helpful</span>
                                </button>
                                <button class="interaction-btn flex-1 flex items-center justify-center space-x-2 text-slate-600 hover:bg-slate-100 rounded-md py-2" data-action="thanks" data-id="${item.id}">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.562 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.865.802V10.333z" /></svg>
                                    <span class="text-sm font-medium">${item.reactions.thanks} Thanks</span>
                                </button>
                                <button class="interaction-btn flex-1 flex items-center justify-center space-x-2 text-slate-600 hover:bg-slate-100 rounded-md py-2" data-action="disputed" data-id="${item.id}">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9" /></svg>
                                    <span class="text-sm font-medium">${item.reactions.disputed} Disputed</span>
                                </button>
                            </div>
                        `;
                    }
                    feedContainer.appendChild(card);
                });
            }

            // --- Notification Bar Logic ---
            function checkNotifications() {
                const notificationBar = document.getElementById('notification-bar');
                const viewSosBtn = document.getElementById('view-sos-btn');
                const activeSos = feedData.find(item => item.type === 'sos');

                if (activeSos) {
                    notificationBar.classList.remove('hidden');
                    setTimeout(() => {
                        notificationBar.classList.remove('-translate-y-full');
                    }, 100);
                    
                    viewSosBtn.onclick = () => {
                        document.getElementById(`post-${activeSos.id}`).scrollIntoView({ behavior: 'smooth', block: 'center' });
                    };
                } else {
                    notificationBar.classList.add('-translate-y-full');
                     setTimeout(() => {
                        notificationBar.classList.add('hidden');
                    }, 500);
                }
            }

            // --- Feed Interaction Handling ---
            document.getElementById('feed-container').addEventListener('click', (e) => {
                const profileLink = e.target.closest('.profile-link');
                if (profileLink) {
                    const username = profileLink.dataset.username;
                    openUserProfileModal(username);
                    return;
                }

                const button = e.target.closest('.interaction-btn');
                if (!button) return;

                const action = button.dataset.action;
                const itemId = parseInt(button.dataset.id);
                const item = feedData.find(i => i.id === itemId);
                if (!item || !item.reactions) return;

                if (action === 'helpful') {
                    item.reactions.helpful++;
                } else if (action === 'thanks') {
                    item.reactions.thanks++;
                    if (users[item.user]) {
                        users[item.user].contributionPoints += 300;
                        alert(`You gave 300 contribution points to ${item.user}!`);
                    }
                } else if (action === 'disputed') {
                    item.reactions.disputed++;
                }
                renderFeed(); // Re-render the entire feed to update counts and status
            });

            // --- Profile Modal ---
            function openUserProfileModal(username) {
                const user = users[username];
                if (!user) return;
                
                const labelInfo = getLabelForScore(user.atlScore);
                const labelEl = document.getElementById('view-profile-label');
                labelEl.textContent = labelInfo.text;
                labelEl.className = `text-sm font-bold text-${labelInfo.color}-600`;

                document.getElementById('view-profile-initials').textContent = user.initials;
                document.getElementById('view-profile-name').textContent = username;
                document.getElementById('view-profile-points').textContent = user.contributionPoints.toLocaleString();
                
                openModal('view-profile-modal');
            }
            document.getElementById('close-profile-modal-btn').addEventListener('click', () => closeModal('view-profile-modal'));

            // --- Video Section ---
            const videoTabBtns = document.querySelectorAll('.video-tab-btn');
            const videoTabContents = document.querySelectorAll('.video-tab-content');

            videoTabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    videoTabBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    const tab = btn.dataset.tab;
                    videoTabContents.forEach(content => {
                        if (content.id === `${tab}-container`) {
                           content.classList.remove('hidden');
                        } else {
                           content.classList.add('hidden');
                        }
                    });
                });
            });

            function renderReels() {
                const reelsContainer = document.getElementById('reels-container');
                reelsContainer.innerHTML = '';
                reelsData.forEach(video => {
                    const reel = document.createElement('div');
                    reel.className = 'reel-item flex items-end justify-between p-4 text-white';
                    reel.style.backgroundImage = `linear-gradient(to top, rgba(0,0,0,0.7), transparent), url(${video.thumbnail})`;
                    
                    reel.innerHTML = `
                        <div class="flex-1">
                            <p class="font-bold">${video.user}</p>
                            <p class="text-sm font-medium">${video.title}</p>
                            <p class="text-xs mt-1">${video.description}</p>
                        </div>
                        <div class="flex flex-col items-center space-y-4">
                            <button class="flex flex-col items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" /></svg>
                                <span class="text-xs font-bold">${video.reactions.helpful}</span>
                            </button>
                            <button class="flex flex-col items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2z" /></svg>
                                <span class="text-xs font-bold">${video.reactions.flag}</span>
                            </button>
                            <button class="flex flex-col items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.562 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.865.802V10.333z" /></svg>
                                <span class="text-xs font-bold">${video.reactions.thanks}</span>
                            </button>
                        </div>
                    `;
                    reelsContainer.appendChild(reel);
                });
            }

            function renderTrainingVideos() {
                const trainingContainer = document.getElementById('training-container');
                trainingContainer.innerHTML = '';
                trainingData.forEach(video => {
                    const card = document.createElement('div');
                    card.className = 'bg-white rounded-lg shadow-md overflow-hidden cursor-pointer';
                    card.innerHTML = `
                        <img src="${video.thumbnail}" alt="${video.title}" class="w-full h-32 object-cover">
                        <div class="p-4">
                            <p class="text-xs font-semibold text-red-600">${video.category}</p>
                            <h3 class="font-bold text-slate-800 mt-1">${video.title}</h3>
                        </div>
                    `;
                    trainingContainer.appendChild(card);
                });
            }
            
            // --- SOS Functionality ---
            const sosButton = document.getElementById('sos-button');
            const cancelSosBtn = document.getElementById('cancel-sos-btn');
            const sosCountdownEl = document.getElementById('sos-countdown');
            const sosLocationEl = document.getElementById('sos-location');
            let sosTimer;
            let countdown;

            sosButton.addEventListener('click', () => {
                openModal('sos-modal');
                countdown = 5;
                sosCountdownEl.textContent = countdown;
                sosLocationEl.textContent = '';
                sosTimer = setInterval(() => {
                    countdown--;
                    sosCountdownEl.textContent = countdown;
                    if (countdown <= 0) {
                        clearInterval(sosTimer);
                        sosCountdownEl.textContent = 'SENT';
                        sosCountdownEl.classList.add('text-emerald-500');
                        sosLocationEl.textContent = 'Lat: 23.9999, Lon: 90.4203';
                        setTimeout(() => {
                            closeModal('sos-modal');
                            sosCountdownEl.textContent = '5';
                            sosCountdownEl.classList.remove('text-emerald-500');
                        }, 3000);
                    }
                }, 1000);
            });

            cancelSosBtn.addEventListener('click', () => {
                clearInterval(sosTimer);
                closeModal('sos-modal');
            });

            // --- Report Functionality ---
            const navReportBtn = document.getElementById('nav-report-btn');
            const reportForm = document.getElementById('report-form');
            const cancelReportBtn = document.getElementById('cancel-report-btn');
            const getLocationBtn = document.getElementById('get-location-btn');
            const reportLocationInput = document.getElementById('report-location');
            const reportTypeRadios = document.querySelectorAll('input[name="report_type"]');
            const formGeneralIssue = document.getElementById('form-general-issue');
            const formUserReport = document.getElementById('form-user-report');
            const formDiaryLog = document.getElementById('form-diary-log');

            reportTypeRadios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    formGeneralIssue.classList.add('hidden');
                    formUserReport.classList.add('hidden');
                    formDiaryLog.classList.add('hidden');
                    if(e.target.value === 'general') formGeneralIssue.classList.remove('hidden');
                    if(e.target.value === 'user') formUserReport.classList.remove('hidden');
                    if(e.target.value === 'diary') formDiaryLog.classList.remove('hidden');
                });
            });

            navReportBtn.addEventListener('click', () => openModal('report-modal'));
            cancelReportBtn.addEventListener('click', () => closeModal('report-modal'));

            getLocationBtn.addEventListener('click', () => {
                reportLocationInput.value = 'Gazipur, Dhaka Division';
            });

            reportForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const reportType = document.querySelector('input[name="report_type"]:checked').value;
                let newPost;

                if (reportType === 'general') {
                    newPost = {
                        id: Date.now(),
                        type: 'gr',
                        title: document.getElementById('report-title').value,
                        description: document.getElementById('report-description').value,
                        location: reportLocationInput.value,
                        user: 'Md Imtiaz Ahmed Nahid',
                        time: 'Just now',
                        reactions: { thanks: 0, disputed: 0, helpful: 0 }
                    };
                     if (!users['Md Imtiaz Ahmed Nahid']) {
                        users['Md Imtiaz Ahmed Nahid'] = { initials: 'MN', joined: 'August 2025', atlScore: 50, contributionPoints: 0 };
                    }
                    feedData.unshift(newPost);
                    renderFeed();
                    switchView('feed');
                } else if (reportType === 'user') {
                    newPost = {
                        id: Date.now(),
                        type: 'case',
                        reporter: 'Md Imtiaz Ahmed Nahid',
                        reportedUser: document.getElementById('report-user-name').value,
                        reason: document.getElementById('report-description').value,
                        status: 'Under Review',
                        time: 'Just now'
                    };
                    feedData.unshift(newPost);
                    renderFeed();
                    switchView('feed');
                } else { // Diary
                    const newEntry = {
                        text: document.getElementById('report-description').value,
                        date: new Date().toLocaleString('en-US', { dateStyle: 'medium', timeStyle: 'short' })
                    };
                    diaryEntries.push(newEntry);
                    switchView('feed'); // Go to feed to show it's not a public post
                }

                reportForm.reset();
                formGeneralIssue.classList.remove('hidden');
                formUserReport.classList.add('hidden');
                formDiaryLog.classList.add('hidden');
                document.getElementById('report_type_general').checked = true;

                closeModal('report-modal');
            });

            // --- SafeCircle Rendering ---
            function renderSafeCircles() {
                const myCirclesContainer = document.getElementById('my-safecircle-container');
                const suggestedCirclesContainer = document.getElementById('suggested-safecircle-container');
                myCirclesContainer.innerHTML = '';
                suggestedCirclesContainer.innerHTML = '';

                mySafeCircles.forEach(circle => {
                    const card = `<div class="bg-white p-4 rounded-lg shadow flex justify-between items-center">
                                    <div>
                                        <p class="font-bold text-slate-800">${circle.name}</p>
                                        <p class="text-sm text-slate-500">${circle.members.length} members</p>
                                    </div>
                                    <button class="text-sm font-bold text-red-600">View</button>
                                </div>`;
                    myCirclesContainer.innerHTML += card;
                });

                suggestedSafeCircles.forEach(circle => {
                    const card = `<div class="bg-white p-4 rounded-lg shadow flex justify-between items-center">
                                    <div>
                                        <p class="font-bold text-slate-800">${circle.name}</p>
                                        <p class="text-sm text-slate-500">${circle.mutual} mutual members</p>
                                    </div>
                                    <button class="bg-red-100 text-red-700 font-bold py-1 px-3 rounded-full text-sm">Join</button>
                                </div>`;
                    suggestedCirclesContainer.innerHTML += card;
                });
            }
            
            // --- Create SafeCircle ---
            document.getElementById('create-safecircle-btn').addEventListener('click', () => openModal('create-safecircle-modal'));
            document.getElementById('cancel-create-safecircle-btn').addEventListener('click', () => closeModal('create-safecircle-modal'));
            document.getElementById('create-safecircle-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('safecircle-name').value;
                const members = document.getElementById('safecircle-members').value.split(',').map(m => m.trim()).filter(Boolean);
                mySafeCircles.push({ id: Date.now(), name, members });
                renderSafeCircles();
                closeModal('create-safecircle-modal');
                document.getElementById('create-safecircle-form').reset();
            });
            
            // --- Safe Map ---
            document.getElementById('safe-map-card').addEventListener('click', () => openModal('safe-map-modal'));
            document.getElementById('close-safe-map-btn').addEventListener('click', () => closeModal('safe-map-modal'));


            // --- Initial Render ---
            renderFeed();
            renderReels();
            renderTrainingVideos();
            renderSafeCircles();
            renderMainProfile();
            checkNotifications();
        });
    </script>
</body>
</html>
